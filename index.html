<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Model Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5rem;
            font-weight: 300;
            letter-spacing: 0.1em;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 50px;
            color: white;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
            border: 1px solid rgba(255, 255, 255, 0.2);
            pointer-events: none;
            user-select: none;
        }

        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            max-width: 80%;
        }

        .error h2 {
            font-weight: 300;
            margin-bottom: 1rem;
        }

        .error p {
            opacity: 0.8;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas-container"></div>
        <div class="loading" id="loading">Loading 3D Model...</div>
        <div class="controls" id="controls" style="display: none;">
            Drag to rotate • Scroll to zoom • Right-click to pan
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/loaders/STLLoader.js"></script>
    <script>
        let scene, camera, renderer, controls, model;
        const container = document.getElementById('canvas-container');
        const loading = document.getElementById('loading');
        const controlsInfo = document.getElementById('controls');

        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = null; // Transparent background

            // Camera setup
            camera = new THREE.PerspectiveCamera(
                45,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 50, 100);

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                alpha: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            // Controls setup
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 30;
            controls.maxDistance = 300;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 2;

            // Lighting setup
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.camera.near = 0.1;
            directionalLight.shadow.camera.far = 200;
            directionalLight.shadow.camera.left = -50;
            directionalLight.shadow.camera.right = 50;
            directionalLight.shadow.camera.top = 50;
            directionalLight.shadow.camera.bottom = -50;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);

            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.3);
            directionalLight2.position.set(-50, 50, -50);
            scene.add(directionalLight2);

            // Load STL file
            loadSTL();

            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);

            // Stop auto-rotation on user interaction
            controls.addEventListener('start', () => {
                controls.autoRotate = false;
            });
        }

        function loadSTL() {
            const loader = new THREE.STLLoader();
            
            // Add debugging
            console.log('Starting to load STL file...');
            
            // Try test cube first, then fall back to main STL
            const stlFiles = ['test-cube.stl', 'Example.stl'];
            let currentFileIndex = 0;
            
            function tryLoadSTL() {
                const currentFile = stlFiles[currentFileIndex];
                console.log(`Trying to load: ${currentFile}`);
                
                loader.load(
                    currentFile,
                    function (geometry) {
                        console.log(`STL file loaded successfully! (${currentFile})`, geometry);
                    // Center the geometry
                    geometry.center();

                    // Calculate bounding box for proper scaling
                    const boundingBox = new THREE.Box3().setFromObject(new THREE.Mesh(geometry));
                    const size = boundingBox.getSize(new THREE.Vector3());
                    const maxDimension = Math.max(size.x, size.y, size.z);
                    const scale = 50 / maxDimension;

                    // Create material with a modern look
                    const material = new THREE.MeshPhongMaterial({
                        color: 0xffffff,
                        specular: 0x111111,
                        shininess: 200,
                        side: THREE.DoubleSide
                    });

                    // Create mesh
                    model = new THREE.Mesh(geometry, material);
                    model.scale.set(scale, scale, scale);
                    model.castShadow = true;
                    model.receiveShadow = true;

                    scene.add(model);

                    // Hide loading, show controls
                    loading.style.display = 'none';
                    controlsInfo.style.display = 'block';

                    // Start animation
                    animate();
                },
                function (xhr) {
                    // Progress callback
                    const percentComplete = (xhr.loaded / xhr.total) * 100;
                    if (!isNaN(percentComplete)) {
                        loading.textContent = `Loading 3D Model... ${Math.round(percentComplete)}%`;
                    }
                },
                    function (error) {
                        // Error callback
                        console.error(`Error loading ${currentFile}:`, error);
                        
                        // Try next file
                        currentFileIndex++;
                        if (currentFileIndex < stlFiles.length) {
                            console.log('Trying next file...');
                            tryLoadSTL();
                        } else {
                            // All files failed
                            console.error('All STL files failed to load');
                            loading.innerHTML = `
                                <div class="error">
                                    <h2>Unable to load 3D model</h2>
                                    <p>Error: ${error.message || 'Unknown error'}</p>
                                    <p>Check browser console for details.</p>
                                    <p>STL files may not be accessible due to Git LFS issues.</p>
                                </div>
                            `;
                        }
                    }
                );
            }
            
            // Start loading
            tryLoadSTL();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Initialize the scene
        init();
    </script>
</body>
</html>
